<!DOCTYPE html><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.3.0 for Hugo" />
  

  
  









  




  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Roboto&display&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto&display&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="U7jZ7b0hmEF2h3bCJtTey4gPa2RTG1IAj4UtXfCMvdU" />
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Alvaro Franco Martins" />

  
  
  
    
  
  <meta name="description" content="Trippy Cosmic Pulse Visualizer - Autoload & Fullscreen  body { margin: 0; background-color: #000000; /* Pure black background */ color: #e0e0e0; font-family: &#39;Inter&#39;, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; /* Center content vertically */ min-height: 100vh; padding: 10px; /* Reduced padding */ box-sizing: border-box; overflow: hidden; /* Prevent scrollbars */ } #playerContainer { display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 15px 20px; background-color: #110f1a; border-radius: 10px; box-shadow: 0 5px 20px rgba(120, 80, 200, 0." />

  
  <link rel="alternate" hreflang="en-us" href="https://alvarofrancomartins.com/post/trippy/" />

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    

    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.cc1fa952786c7d5551c3adc1183830fe.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-QGS19RLHHY"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'G-QGS19RLHHY', {});
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  

  

  




  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu2554c39cea7f7ac56f2127a9008220c1_75996_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu2554c39cea7f7ac56f2127a9008220c1_75996_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://alvarofrancomartins.com/post/trippy/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@alvarofmartins" />
    <meta property="twitter:creator" content="@alvarofmartins" />
  
  <meta property="og:site_name" content="Alvaro Franco Martins" />
  <meta property="og:url" content="https://alvarofrancomartins.com/post/trippy/" />
  <meta property="og:title" content="Trippy | Alvaro Franco Martins" />
  <meta property="og:description" content="Trippy Cosmic Pulse Visualizer - Autoload & Fullscreen  body { margin: 0; background-color: #000000; /* Pure black background */ color: #e0e0e0; font-family: &#39;Inter&#39;, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; /* Center content vertically */ min-height: 100vh; padding: 10px; /* Reduced padding */ box-sizing: border-box; overflow: hidden; /* Prevent scrollbars */ } #playerContainer { display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 15px 20px; background-color: #110f1a; border-radius: 10px; box-shadow: 0 5px 20px rgba(120, 80, 200, 0." /><meta property="og:image" content="https://alvarofrancomartins.com/media/sharing.png" />
    <meta property="twitter:image" content="https://alvarofrancomartins.com/media/sharing.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2025-01-01T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2025-01-01T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://alvarofrancomartins.com/post/trippy/"
  },
  "headline": "Trippy",
  
  "datePublished": "2025-01-01T00:00:00Z",
  "dateModified": "2025-01-01T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Alvaro Franco Martins"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Alvaro Franco Martins",
    "logo": {
      "@type": "ImageObject",
      "url": "https://alvarofrancomartins.com/media/icon_hu2554c39cea7f7ac56f2127a9008220c1_75996_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "Trippy Cosmic Pulse Visualizer - Autoload \u0026 Fullscreen  body { margin: 0; background-color: #000000; /* Pure black background */ color: #e0e0e0; font-family: 'Inter', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; /* Center content vertically */ min-height: 100vh; padding: 10px; /* Reduced padding */ box-sizing: border-box; overflow: hidden; /* Prevent scrollbars */ } #playerContainer { display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 15px 20px; background-color: #110f1a; border-radius: 10px; box-shadow: 0 5px 20px rgba(120, 80, 200, 0."
}
</script>

  

  

  

  <head>
   <style>
   p {
      margin-top: 0;
      margin-bottom: 0rem;
      text-align: justify;
   }

   .article-container {
      max-width: 1250px;
   }

 

   #container-publications {
      overflow: visible !important;
   }

   .see-all {
      text-transform: none !important;
   }

   html {
   scroll-behavior: smooth !important;
   }

   .docs-toc {
      padding-top:  3.2rem;
   }

   figure {
    display: flex;
    flex-flow: column;
}
   .stream-item {
      padding-top: 25px;
   }

figcaption {
   
  font-family: "Roboto", sans-serif;
  font-weight: 500;
  margin-top: 0.5rem !important; 
  margin-bottom: 0rem !important;
  margin-right:  0.5rem !important;
  line-height: 1.25;
  color: inherit;
  text-rendering: optimizeLegibility;
   
  overflow-wrap: break-word; 
  word-wrap: break-word;
  word-break: break-word;
   
  -webkit-hyphens: manual;
  -ms-hyphens: manual;
  hyphens: manual; 
}

div.alert > div {
text-align: justify;

}



   </style>

   <script src="/js/prism.js"></script>

   <link rel="stylesheet" href="/css/prism.css" type="text/css"/> 

</head>

  <title>Trippy | Alvaro Franco Martins</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="eeba62ef02311a6e4327f67ec98ca220" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.da42964e270e05a6063fbca894d7ccff.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Alvaro Franco Martins</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Alvaro Franco Martins</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/publication"><span>Publications</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      
        
      

      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      

      
      

    </ul>

  </div>
</nav>


  </div>

  <div class="page-body">
    
        <article class="article">
            












  

  
  
  
<div class="article-container pt-3">
  <h1>Trippy</h1>

  

  
    


<div class="article-metadata">

  
  
  
  
  <div>
    

  <span class="author-highlighted">
      <a href="/author/alvaro-franco-martins/">Alvaro Franco Martins</a></span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    Jan 1, 2025
  </span>
  

  

  

  
  
  
  
  
  

  
  

</div>

    





  
</div>


            <div class="article-container">
              <div class="article-style">
                
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trippy Cosmic Pulse Visualizer - Autoload & Fullscreen</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            background-color: #000000; /* Pure black background */
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center content vertically */
            min-height: 100vh;
            padding: 10px; /* Reduced padding */
            box-sizing: border-box;
            overflow: hidden; /* Prevent scrollbars */
        }

        #playerContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px; 
            padding: 15px 20px;
            background-color: #110f1a; 
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(120, 80, 200, 0.2); 
            margin-bottom: 15px; /* Adjusted margin */
            border: 1px solid #302050;
            z-index: 10; 
        }
        
        #songInfoDisplay {
            font-size: 14px;
            color: #aaa;
            min-height: 20px;
            text-align: center;
        }

        #audioPlayer {
            width: 100%;
            max-width: 380px; /* Slightly smaller player */
            border-radius: 6px;
        }
        #audioPlayer::-webkit-media-controls-panel {
            background-color: #1a1026;
            border-radius: 6px;
            border: 1px solid #403060;
        }
        #audioPlayer::-webkit-media-controls-play-button,
        #audioPlayer::-webkit-media-controls-mute-button,
        #audioPlayer::-webkit-media-controls-timeline,
        #audioPlayer::-webkit-media-controls-current-time-display,
        #audioPlayer::-webkit-media-controls-time-remaining-display,
        #audioPlayer::-webkit-media-controls-volume-slider {
             filter: invert(1) hue-rotate(240deg) brightness(0.7) contrast(1.5);
        }

        #fullscreenBtn {
            padding: 8px 15px;
            background-color: #2a1a3a;
            color: #c0a0ff;
            border: 1px solid #c0a0ff;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
            font-size: 14px;
            margin-top: 5px;
        }
        #fullscreenBtn:hover {
            background-color: #c0a0ff;
            color: #110f1a;
        }

        #visualizerCanvas {
            border: 1px solid #201030; 
            background-color: black;
            border-radius: 8px; 
            box-shadow: 0 0 30px rgba(80, 50, 150, 0.4); 
            max-width: 98vw; 
            max-height: 90vh; /* Increased default max height */
            display: block; /* Important for proper sizing */
        }

        .message-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #e0d0ff;
            font-size: 18px;
            text-align: center;
            padding: 20px;
            background-color: rgba(10, 5, 20, 0.75);
            border-radius: 8px;
            border: 1px solid #504070;
            z-index: 5; 
        }
    </style>
</head>
<body>
    <div id="playerContainer">
        <div id="songInfoDisplay">Loading song.mp3...</div>
        <audio id="audioPlayer" controls></audio>
        <button id="fullscreenBtn">Fullscreen</button>
    </div>

    <canvas id="visualizerCanvas"></canvas>
    <div id="canvasMessage" class="message-overlay" style="display: none;"></div>

    <script>
        // --- Global Variables ---
        let audioContext;
        let analyser;
        let sourceNode;
        let dataArray; 
        let canvas, ctx;
        let audioPlayer;
        let songInfoDisplay; 
        let fullscreenBtn;
        let animationFrameId;
        let canvasMessageDiv;

        let particles = [];
        const PARTICLE_BASE_LIFE = 220; // Even longer life for more trails
        const MAX_PARTICLES = 550;    // More particles for intensity

        let audioMetrics = {
            overallVolume: 0,
            bass: 0,
            mid: 0,
            treble: 0
        };
        
        let globalHueOffset = 0; // For global color shifting

        // --- Particle Class ---
        class Particle {
            constructor(x, y, radius, colorH, speed, direction, life) {
                this.x = x;
                this.y = y;
                this.initialRadius = radius; // Store initial radius for pulsing
                this.radius = radius;
                this.colorH = colorH; 
                this.speed = speed;
                this.initialSpeed = speed; // Store initial speed
                this.direction = direction; 
                this.vx = Math.cos(direction) * speed;
                this.vy = Math.sin(direction) * speed;
                this.life = life;
                this.initialLife = life;
                this.opacity = 1;
                this.saturation = 100;
                this.lightness = 60; 
                this.angularVelocity = (Math.random() - 0.5) * 0.02; // Slow, random rotation
                this.hueShiftSpeed = (Math.random() - 0.5) * 2; // How fast its own hue shifts
            }

            update() {
                this.life--;
                this.opacity = Math.max(0, (this.life / this.initialLife) * 2.0); // Brighter overall, fades sharply
                this.opacity = Math.min(1, this.opacity); 

                this.direction += this.angularVelocity * (audioMetrics.treble + 0.1); // Treble influences spin
                this.vx = Math.cos(this.direction) * this.speed;
                this.vy = Math.sin(this.direction) * this.speed;

                this.x += this.vx;
                this.y += this.vy;
                
                this.speed *= 0.995; // Slower decay for very wide travel
                this.speed = Math.max(0.1, this.speed); // Prevent speed from becoming zero

                this.colorH = (this.colorH + this.hueShiftSpeed * (audioMetrics.mid + 0.2)) % 360; // Shift hue over time, influenced by mid
                
                // Pulsing radius based on bass and its own life
                const lifeRatio = this.life / this.initialLife;
                this.radius = this.initialRadius * (0.3 + 0.7 * lifeRatio) * (1 + audioMetrics.bass * 0.5 * Math.sin(this.life * 0.1));
                this.radius = Math.max(0.8, this.radius);
            }

            draw(ctx) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                
                let particleLightness = 50 + audioMetrics.overallVolume * 25; // More dynamic lightness
                particleLightness = Math.min(85, particleLightness); // Cap lightness

                const finalHue = (this.colorH + globalHueOffset) % 360;

                ctx.fillStyle = `hsla(${finalHue}, ${this.saturation}%, ${particleLightness}%, ${this.opacity})`;
                ctx.shadowColor = `hsla(${finalHue}, ${this.saturation}%, ${particleLightness}%, 0.5)`; // Slightly less intense shadow
                ctx.shadowBlur = this.radius * 0.8 + 10; // Larger, softer glow
                ctx.fill();
            }

            isDead() {
                return this.life <= 0 || this.opacity <= 0 || this.radius < 0.5;
            }
        }

        // --- Initialization and Event Handlers ---
        function init() {
            audioPlayer = document.getElementById('audioPlayer');
            canvas = document.getElementById('visualizerCanvas');
            ctx = canvas.getContext('2d');
            songInfoDisplay = document.getElementById('songInfoDisplay');
            fullscreenBtn = document.getElementById('fullscreenBtn');
            canvasMessageDiv = document.getElementById('canvasMessage');

            resizeCanvas(); 
            window.addEventListener('resize', resizeCanvas);
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            
            loadDefaultSong();

            audioPlayer.onplay = () => {
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume().catch(e => console.error("AudioContext resume error:", e));
                }
                if (!animationFrameId && analyser && dataArray) {
                    draw();
                }
                songInfoDisplay.textContent = "Playing: song.mp3";
            };
            audioPlayer.onpause = () => {
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                drawInitialCanvasState("Paused. Press play to resume.");
                if (audioPlayer.src.endsWith("song.mp3")) { 
                    songInfoDisplay.textContent = "Paused: song.mp3";
                }
            };
            audioPlayer.onended = () => {
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                particles = []; 
                drawInitialCanvasState("Playback ended. Reload to play again.");
                 if (audioPlayer.src.endsWith("song.mp3")) {
                    songInfoDisplay.textContent = "Finished: song.mp3";
                }
            };
             audioPlayer.onerror = (e) => {
                console.error("Audio player error:", e);
                const errorMessage = "Error loading song.mp3. Make sure it's in the same directory.";
                songInfoDisplay.textContent = errorMessage;
                showCanvasMessage(errorMessage, true);
                drawInitialCanvasState(errorMessage);
            };
            
            drawInitialCanvasState("Attempting to load song.mp3...");
        }

        function resizeCanvas() {
            if (document.fullscreenElement === canvas || document.webkitFullscreenElement === canvas) {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            } else {
                const playerContainerHeight = document.getElementById('playerContainer').offsetHeight;
                const availableHeight = window.innerHeight - playerContainerHeight - 40; 

                canvas.width = Math.min(window.innerWidth * 0.95, 1200);
                canvas.height = Math.min(availableHeight * 0.95, 800); 
                canvas.height = Math.max(300, canvas.height); 
            }
            
            if (!animationFrameId && (!audioPlayer || !audioPlayer.src || audioPlayer.paused)) {
                 drawInitialCanvasState(songInfoDisplay.textContent || "Attempting to load song.mp3...");
            }
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                if (canvas.requestFullscreen) {
                    canvas.requestFullscreen();
                } else if (canvas.webkitRequestFullscreen) { 
                    canvas.webkitRequestFullscreen();
                }
                fullscreenBtn.textContent = "Exit Fullscreen";
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) { 
                    document.webkitExitFullscreen();
                }
                fullscreenBtn.textContent = "Fullscreen";
            }
        }

        function handleFullscreenChange() {
            resizeCanvas(); 
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                fullscreenBtn.textContent = "Fullscreen";
            } else {
                fullscreenBtn.textContent = "Exit Fullscreen";
            }
        }


        function drawInitialCanvasState(message = "Loading audio...") {
            if (!ctx) return;
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.font = `bold ${Math.min(20, canvas.width / 35)}px Inter`;
            ctx.fillStyle = "rgba(180, 160, 255, 0.7)"; 
            ctx.textAlign = "center";
            ctx.fillText(message, canvas.width / 2, canvas.height / 2);
        }
        
        function showCanvasMessage(message, isError = false) {
            canvasMessageDiv.textContent = message;
            canvasMessageDiv.style.color = isError ? '#ff6b6b' : '#e0d0ff';
            canvasMessageDiv.style.backgroundColor = isError ? 'rgba(100,0,0,0.7)' : 'rgba(10,5,20,0.75)';
            canvasMessageDiv.style.display = 'block';
        }

        function hideCanvasMessage() {
            canvasMessageDiv.style.display = 'none';
        }

        async function loadDefaultSong() {
            hideCanvasMessage();
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            particles = []; 

            audioPlayer.src = 'song.mp3'; 

            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    const errorMsg = "Error: Web Audio API is not supported.";
                    showCanvasMessage(errorMsg, true);
                    drawInitialCanvasState(errorMsg);
                    songInfoDisplay.textContent = errorMsg;
                    return;
                }
            }
            if (audioContext.state === 'suspended') {
                console.log("AudioContext is suspended. Waiting for user interaction.");
            }

            if (!analyser) {
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 1024; 
                analyser.smoothingTimeConstant = 0.5; // Even more responsive for trippy effects
                const bufferLength = analyser.frequencyBinCount; 
                dataArray = new Uint8Array(bufferLength);
            }

            if (sourceNode) {
                sourceNode.disconnect();
            }
            sourceNode = audioContext.createMediaElementSource(audioPlayer);
            sourceNode.connect(analyser);
            analyser.connect(audioContext.destination);

            try {
                await audioPlayer.play(); 
                songInfoDisplay.textContent = "Playing: song.mp3";
            } catch (error) {
                console.warn("Autoplay was prevented or an error occurred:", error);
                if (error.name === 'NotAllowedError') {
                    const playMsg = "Autoplay blocked. Click play to start.";
                    songInfoDisplay.textContent = playMsg;
                    drawInitialCanvasState(playMsg);
                } else {
                    const errorMsg = `Error playing song.mp3: ${error.message}.`;
                    songInfoDisplay.textContent = errorMsg;
                    showCanvasMessage(errorMsg, true);
                    drawInitialCanvasState(errorMsg);
                }
            }
        }

        function updateAudioMetrics() {
            if (!analyser || !dataArray) return;
            analyser.getByteFrequencyData(dataArray);

            const bufferLength = analyser.frequencyBinCount; 
            let bassSum = 0, midSum = 0, trebleSum = 0, overallSum = 0;
            const bassEndIndex = Math.floor(bufferLength * 0.12); // Focus bass on lower frequencies
            const midEndIndex = Math.floor(bufferLength * 0.55);  
            const trebleStartIndex = Math.floor(bufferLength * 0.65); // More distinct treble band

            for (let i = 0; i < bufferLength; i++) {
                const value = dataArray[i];
                overallSum += value;
                if (i < bassEndIndex) {
                    bassSum += value;
                } else if (i >= bassEndIndex && i < midEndIndex) { // Ensure mid is distinct
                    midSum += value;
                } else if (i >= trebleStartIndex) { // Ensure treble is distinct
                    trebleSum += value;
                }
            }

            audioMetrics.overallVolume = (overallSum / bufferLength) / 255; 
            audioMetrics.bass = (bassSum / (bassEndIndex || 1)) / 255;
            audioMetrics.mid = (midSum / ((midEndIndex - bassEndIndex) || 1)) / 255;
            audioMetrics.treble = (trebleSum / ((bufferLength - trebleStartIndex) || 1)) / 255;
        }
        
        function emitParticles() {
            if (particles.length > MAX_PARTICLES) return;

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const numToEmit = Math.floor(audioMetrics.overallVolume * 30 + audioMetrics.bass * 20 + audioMetrics.treble * 10); 

            for (let i = 0; i < numToEmit; i++) {
                const baseSpeed = 2.5 + audioMetrics.overallVolume * 6.0 + audioMetrics.treble * 2.0; 
                const speedVariance = audioMetrics.treble * 4.0; 
                const speed = baseSpeed + (Math.random() - 0.5) * speedVariance;
                const direction = Math.random() * Math.PI * 2; 
                let radius = 3 + audioMetrics.bass * 22 + Math.random() * 7; 
                radius = Math.max(1.5, radius); 
                
                // Initial hue more spread out and reactive
                let hue = (180 + audioMetrics.mid * 150 + (audioMetrics.bass - 0.5) * 90 - (audioMetrics.treble - 0.5) * 70) % 360;
                if (hue < 0) hue += 360;


                let life = PARTICLE_BASE_LIFE * (0.75 + audioMetrics.overallVolume * 0.5); 
                if (audioMetrics.treble > 0.6 && Math.random() < 0.35) { 
                    hue = (30 + Math.random() * 60) % 360; // Intense, bright sparkles
                    radius *= 0.45; 
                    life *= 0.30; 
                }
                particles.push(new Particle(centerX, centerY, radius, hue, speed, direction, life));
            }
        }

        function draw() {
            animationFrameId = requestAnimationFrame(draw);

            if (!analyser || !dataArray || !ctx) return;
            updateAudioMetrics(); 
            
            globalHueOffset = (globalHueOffset + 0.2 * (audioMetrics.overallVolume + 0.1)) % 360; // Slow global hue shift

            // Very low alpha for extreme trails, creating afterimage effects
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.shadowColor = 'transparent'; // Reset shadow for the frame
            ctx.shadowBlur = 0;

            hideCanvasMessage(); 
            emitParticles();
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                if (particles[i].isDead()) {
                    particles.splice(i, 1); 
                } else {
                    particles[i].draw(ctx);
                }
            }
        }

        window.onload = init;
    </script>
</body>
</html>


              </div>
              


















  
  
    



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://alvarofrancomartins.com"><img class="avatar mr-3 avatar-circle" src="/author/alvaro-franco-martins/avatar_hu9663ca6c1fda1d039f779a01a14750c7_758770_270x270_fill_q100_lanczos_center.jpg" alt="Alvaro Franco Martins"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://alvarofrancomartins.com">Alvaro Franco Martins</a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:alvarought@gmail.com" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/alvarofmartins" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com.br/citations?user=yB30J2MAAAAJ" target="_blank" rel="noopener">
        <i class="fas fa-graduation-cap"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Alvaro-Martins-2" target="_blank" rel="noopener">
        <i class="fab fa-researchgate"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/alvarofrancomartins" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/alvarofrancomartins/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  














  
  




            </div>
        </article>
  
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">
  

  <p class="powered-by">
    
  </p>

  
  






  <p class="powered-by" style="font-size:11px;">
    
    Published with
    <a href="https://wowchemy.com/" target="_blank" rel="noopener">Wowchemy</a>. 
    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>
    </div>
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    <script src="/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js"></script>

    
    
    
      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      

    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    
      
      
      
      
      
      
      
    

    
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.b206710415a50cb12ea588a8ed1fe3c5.js"></script>

    






</body>
</html>
